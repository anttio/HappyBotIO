!function(e){function t(n){if(r[n])return r[n].exports;var a=r[n]={exports:{},id:n,loaded:!1};return e[n].call(a.exports,a,a.exports,t),a.loaded=!0,a.exports}var r={};return t.m=e,t.c=r,t.p="/dist/",t(0)}([function(e,t,r){e.exports=r(1)},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var a=r(2),i=n(a),s=r(4),o=n(s),u=new o["default"]({username:process.env.KMKISA_USERNAME,password:process.env.KMKISA_PASSWORD,loginURL:process.env.KMKISA_LOGIN_URL,teamURL:process.env.KMKISA_TEAM_URL});i["default"].hears(["kmkisa"],["direct_message","direct_mention"],function(e,t){u.getTeamStatistics(function(r){e.reply(t,{text:"Your team is currently ranked at "+r.team.ranking+" and it has cycled "+r.team.mileage+" kilometers.",attachments:u.getMemberStatisticsForSlackBot(r.members)})})})},function(e,t,r){"use strict";var n=r(3);process.env.SLACK_API_TOKEN||(console.log("Error: Specify Slack access token in environment."),process.exit(1));var a=n.slackbot({debug:!1});a.spawn({token:process.env.SLACK_API_TOKEN}).startRTM(function(e){if(e)throw new Error(e)}),e.exports=a},function(e,t){e.exports=require("botkit")},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(5),s=r(6).defaults({jar:!0}),o=function(){function e(t){n(this,e),this._username=t.username,this._password=t.password,this._loginURL=t.loginURL,this._teamURL=t.teamURL}return a(e,[{key:"_getCSRFMiddlewareToken",value:function(e){return!!this._loginURL&&(s(this._loginURL,function(t,r,n){if(!t&&200===r.statusCode){var a=i.load(n),s=a('[name="csrfmiddlewaretoken"]')[0].attribs.value;e(s)}}),!0)}},{key:"_logIn",value:function(e,t){return!!(this._loginURL&&this._username&&this._password&&e)&&(s({url:this._loginURL,method:"POST",form:{username:this._username,password:this._password,csrfmiddlewaretoken:e},headers:{referer:this._loginURL}},function(e){e||t()}),!0)}},{key:"_fetchTeamStatistics",value:function(e){if(!this._teamURL)return!1;var t={};return s(this._teamURL,function(r,n,a){if(!r&&200===n.statusCode){var s=i.load(a),o=s(".team-contest-table").find("li");t.team={ranking:o.eq(1).find("strong").text().trim(),mileage:o.eq(3).text().trim().replace(/^\D+/g,"").replace(" km",""),days:o.eq(5).text().trim().replace(/^\D+/g,"")};var u=s('[data-slug="my-team"]').find("tbody tr");t.members=[],u.each(function(e,r){var n=s(r).find("td");t.members.push([n.eq(1).text().trim(),n.eq(2).text().trim(),n.eq(3).text().trim()])}),e(t)}}),!0}},{key:"getTeamStatistics",value:function(e){var t=this;this._getCSRFMiddlewareToken(function(r){return t._logIn(r,function(){return t._fetchTeamStatistics(function(t){return e(t)})})})}},{key:"getMemberStatisticsForSlackBot",value:function(e){for(var t=[],r=0;r<e.length;r++){var n=parseFloat(e[r][1].replace(/\s/g,""));console.log(n);var a=parseInt(e[r][2]),i=e[r][1].replace(",",".")+" km | "+a+" days";n>0&&a>0&&(i+=" | "+(n/a).toFixed(2)+" km daily avg."),t.push({color:0===r?"#cfb53b":1===r?"#e6e8fa":2===r?"#8c7853":"#f8f8f8",author_name:e[r][0],text:i})}return t}}]),e}();t["default"]=o},function(e,t){e.exports=require("cheerio")},function(e,t){e.exports=require("request")}]);
//# sourceMappingURL=bundle.js.map